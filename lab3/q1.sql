-- i)
CREATE TABLE PERSON (
    DRIVER_ID VARCHAR(30),
    NAME VARCHAR(50),
    ADDRESS VARCHAR(100),
    PRIMARY KEY (DRIVER_ID)
);

CREATE TABLE CAR (
    REGNO VARCHAR(20),
    MODEL VARCHAR(30),
    YEAR INT,
    PRIMARY KEY (REGNO)
);

CREATE TABLE ACCIDENT (
    REPORT_NUMBER INT,
    ACCD_DATE DATE,
    LOCATION VARCHAR(50),
    PRIMARY KEY (REPORT_NUMBER)
);

CREATE TABLE OWNS (
    DRIVER_ID VARCHAR(30),
    REGNO VARCHAR(20),
    FOREIGN KEY (DRIVER_ID) REFERENCES PERSON,
    FOREIGN KEY (REGNO) REFERENCES CAR
);

CREATE TABLE PARTICIPATED (
    DRIVER_ID VARCHAR(30),
    REGNO VARCHAR(20),
    REPORT_NUMBER INT,
    DAMAGE_AMOUNT INT,
    PRIMARY KEY (DRIVER_ID, REGNO, REPORT_NUMBER),
    FOREIGN KEY (DRIVER_ID) REFERENCES PERSON,
    FOREIGN KEY (REGNO) REFERENCES CAR,
    FOREIGN KEY (REPORT_NUMBER) REFERENCES ACCIDENT ON DELETE CASCADE
);

-- ii)
INSERT INTO PERSON VALUES ('834923', 'Anub Sharma', 'C23, Shyam Apartments, Delhi', 25, 'M');
INSERT INTO PERSON VALUES ('324984', 'Rahul Verma', 'Door no 23, Flat 23341, Mumbai');
INSERT INTO PERSON VALUES ('654264', 'Ramcharan S', 'Star Enterprises, Hauz Khas, Gurgaon');
INSERT INTO PERSON VALUES ('867412', 'Arvind D', 'Agent Gardens, Paul Abode, Golf Street, Delhi');
INSERT INTO PERSON VALUES ('245366', 'Shravan Thomas', 'Indira Flats, Car Street, Sector 34, Noida');
INSERT INTO PERSON VALUES ('324234', 'Rohan Mathur', 'T34, Floyd Apartments, Rajajinagar, S34');
INSERT INTO PERSON VALUES ('954389', 'Paritesh Manna', 'Pari Villa, Villa Novela, Deakin Road, Delhi');
SELECT * FROM PERSON;
COMMIT;

ALTER TABLE PERSON MODIFY driver_id VARCHAR(6);
ALTER TABLE PERSON MODIFY NAME VARCHAR(20);
ALTER TABLE PERSON MODIFY ADDRESS VARCHAR(50);

-- ORA-00001: unique constraint (IT434.SYS_C0042707) violated
-- ORA-01441: cannot decrease column length because some value is too big
-- ORA-12899: value too large for column "IT434"."PERSON"."DRIVER_ID" (actual: 11, maximum: 6)

INSERT INTO CAR VALUES ('KA20Z2345', 'Ford Fiesta', 2010);
INSERT INTO CAR VALUES ('KA19S1293', 'Toyota Fortuner', 2020);
INSERT INTO CAR VALUES ('KA40X3982', 'Honda City', 2017);
INSERT INTO CAR VALUES ('DL10AA3292', 'Honda Ecord', 2015);
INSERT INTO CAR VALUES ('MH34MA2200', 'Hyundai I20', 2007);
INSERT INTO CAR VALUES ('PJ23J3453', 'BMW S3', 2020);
INSERT INTO CAR VALUES ('KL23O8902', 'Tata Tiagor', 2023);
SELECT * FROM CAR;
COMMIT;


INSERT INTO ACCIDENT VALUES (10102, '02-Jan-2020', 'Lane 2, Sector 34');
INSERT INTO ACCIDENT VALUES (10234, TO_DATE('2020-03-12', 'yyyy-mm-dd'), 'Near Hotel Finia, Main road, Connhaught Palace');
INSERT INTO ACCIDENT VALUES (10455, TO_DATE('2021-04-21', 'yyyy-mm-dd'), 'Indian Oil Petrol Bunk, Pauli Cross, NH 23, Noida');
INSERT INTO ACCIDENT VALUES (10467, TO_DATE('2021-05-04', 'yyyy-mm-dd'), 'Shardam Society, Manna Gali, Old Delhi');
INSERT INTO ACCIDENT VALUES (10564, TO_DATE('2021-05-06', 'yyyy-mm-dd'), 'Radio Shop, BIG3 Mall Parking, Sector 23, Delhi');
INSERT INTO ACCIDENT VALUES (10983, TO_DATE('2021-05-06', 'yyyy-mm-dd'), 'Radio Shop, BIG3 Mall Parking, Sector 23, Delhi');
INSERT INTO ACCIDENT VALUES (11883, TO_DATE('2023-01-14', 'yyyy-mm-dd'), 'Delete test site, Raipur');
SELECT * FROM ACCIDENT;
COMMIT;

-- ORA-01830: date format picture ends before converting entire input string
-- ORA-01839: date not valid for month specified

INSERT INTO OWNS VALUES ('324984','KA20Z2345');
INSERT INTO OWNS VALUES ('834923','KA19S1293');
INSERT INTO OWNS VALUES ('654264','KA40X3982');
INSERT INTO OWNS VALUES ('867412','DL10AA3292');
INSERT INTO OWNS VALUES ('245366','MH34MA2200');
SELECT * FROM OWNS;
COMMIT;

INSERT INTO PARTICIPATED VALUES ('654264','KA40X3982', 10234, 21322);
INSERT INTO PARTICIPATED VALUES ('324984','KA20Z2345', 10234, 2213);
INSERT INTO PARTICIPATED VALUES ('245366','MH34MA2200', 10455, 103232);
INSERT INTO PARTICIPATED VALUES ('834923','KA19S1293', 10467, 220212, 90000);
INSERT INTO PARTICIPATED VALUES ('954389','PJ23J3453', 10564, 453);
INSERT INTO PARTICIPATED VALUES ('324234','KL23O8902', 10983, 10021);
SELECT * FROM PARTICIPATED;
COMMIT;

UPDATE PERSON SET ADDRESS='Indira Flats, Car Street, Sector 34, Noida' WHERE DRIVER_ID='245366';
UPDATE CAR SET REGNO='KA40X3982' WHERE REGNO='KA40x3982';
DELETE FROM OWNS WHERE REGNO='KA40x3982';
DELETE FROM PARTICIPATED WHERE DRIVER_ID='324984';

INSERT INTO PARTICIPATED VALUES ('324984','KA20Z2345', 10234, 2213, 1230);

-- iii)
UPDATE PARTICIPATED SET DAMAGE_AMOUNT=25000 WHERE REPORT_NUMBER=10983; -- REPORT_NUMBER=12

-- iv)
INSERT INTO ACCIDENT VALUES (11883, TO_DATE('2023-01-14', 'yyyy-mm-dd'), 'Delete test site, Raipur');
DELETE FROM ACCIDENT WHERE EXTRACT(YEAR FROM ACCD_DATE)=2023;
SELECT ACCD_DATE FROM ACCIDENT WHERE EXTRACT(YEAR FROM ACCD_DATE)=2023;

-- v)
ALTER TABLE PERSON ADD age INT;
ALTER TABLE PERSON ADD gender CHAR(1);
ALTER TABLE PERSON DROP age INT;

ALTER TABLE PERSON MODIFY age NUMBER(3) CHECK(age > 18 AND age < 110);

SELECT * FROM PERSON;
SELECT * FROM CAR;
SELECT * FROM ACCIDENT;
SELECT * FROM OWNS;
SELECT * FROM PARTICIPATED;

-- vi)
INSERT INTO PERSON (DRIVER_ID, NAME, ADDRESS) VALUES ('101043', 'Naman Singh', 'Manan Society, Sector 2, Delhi');
INSERT INTO PERSON VALUES ('323431', 'Naman Singh II', 'Manan Society, Sector 2, Delhi', 112, 'M');
INSERT INTO PERSON VALUES ('101043', 'Naman Singh III', 'Manan Society, Sector 2, Delhi', 102, 'M');

-- ORA-00001: unique constraint (IT434.SYS_C0042707) violated
DELETE FROM PERSON WHERE DRIVER_ID='101043';

UPDATE CAR SET REGNO='KA40Z3982' WHERE REGNO='KA40X3982';

ALTER TABLE PARTICIPATED DROP CONSTRAINT SYS_C0042864;
ALTER TABLE PARTICIPATED ADD CONSTRAINT FOREIGN_KEY_ACCIDENT_REPORT_NUMBER FOREIGN KEY (REPORT_NUMBER) REFERENCES ACCIDENT ON DELETE CASCADE;

UPDATE CAR SET REGNO='KA40X3982' WHERE REGNO='KA40Z3982';
